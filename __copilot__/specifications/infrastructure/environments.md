# Environment Configuration

## Development (dev)

**Configuration File**: `config-dev.json`

The development environment is used for:
- Testing new features
- Integration testing
- Developer experimentation
- Build output: `web-build/dev/`

### Characteristics
- Auto-delete objects on bucket deletion: `True`
- Stack removal policy: `DESTROY`
- DynamoDB removal policy: `DESTROY`
- S3 assets bucket: Lifecycle rules enabled (IA after 60 days, expire after 5 years)
- Lower cost resources where applicable
- More permissive for debugging

## Production (prod)

**Configuration File**: `config-prod.json`

The production environment is used for:
- Live application serving
- Production traffic
- Customer-facing services
- Build output: `web-build/prod/`

### Characteristics
- Auto-delete objects on bucket deletion: `False`
- Stack removal policy: `RETAIN`
- DynamoDB removal policy: `RETAIN`
- S3 assets bucket: Lifecycle rules enabled (IA after 60 days, expire after 5 years)
- High availability configuration
- Stricter security controls
- Data retention policies
- Backup and disaster recovery considerations

## Environment Isolation

Each environment should have:
- Separate AWS resources (S3 buckets, CloudFront distributions, etc.)
- Isolated IAM roles and policies
- Independent deployment pipelines
- Distinct naming conventions (prefixed with environment name)
- Separate configuration files
- Separate output files

## Naming Conventions

Resources are named with the following patterns:

### Stack Names
- Development: `ProgramRig-Stack-dev`
- Production: `ProgramRig-Stack-prod`

### Resource Names
- **DynamoDB Table**: `program-rig-cache-{env}`
- **S3 Buckets**: Auto-generated by CDK with logical IDs:
  - `ProgramRigWebsiteBucket` (hosting)
  - `ProgramRigAssetsDataBucket` (assets)
- **CloudFront Distribution**: `ProgramRigCloudFrontDistribution`
- **CloudFront Function**: `ProgramRigUrlRewriteFunction`

### Domain Names
- Development: `pr-dev.helpfulowl.com` (or configured domain)
- Production: `pr.helpfulowl.com` (or configured domain)

## Switching Environments

To deploy to a specific environment:

1. Run deployment script with environment parameter:
   ```bash
   ./deploy.sh dev
   # or
   ./deploy.sh prod
   ```

2. To deploy with web build sync:
   ```bash
   DO_S3_DEPLOY=TRUE ./deploy.sh dev
   # or
   export DO_S3_DEPLOY=TRUE
   ./deploy.sh dev && ./deploy.sh prod
   ```

## Configuration Management

- Store non-sensitive configuration in JSON files (checked into git)
- Use AWS Secrets Manager for sensitive data (API keys, passwords)
- Keep configuration structure consistent across environments
- Version control all configuration files
- Document any environment-specific differences

## Build Output Sync

The infrastructure syncs build outputs from:
- `../web-build/dev/` → S3 bucket (dev environment)
- `../web-build/prod/` → S3 bucket (prod environment)

These paths are configured in the CDK stack and should match the NextJS build output configuration.

## Environment Variables

Deployment scripts may use:
- `AWS_PROFILE`: AWS CLI profile to use
- `CDK_DEFAULT_ACCOUNT`: AWS account ID
- `CDK_DEFAULT_REGION`: AWS region
- Environment-specific variables as needed

## Promotion Strategy

To promote changes from dev to prod:

1. Deploy and test in dev environment
2. Verify functionality thoroughly
3. Review infrastructure changes with `./diff.sh`
4. Deploy to prod environment
5. Monitor for issues
6. Keep rollback plan ready
